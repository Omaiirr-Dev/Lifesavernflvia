<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omairs NFL Term Helper</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .tab-btn {
            padding: 12px 24px;
            background: #3a3a3a;
            border: 2px solid #555;
            color: #e0e0e0;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 15px;
        }

        .tab-btn:hover {
            background: #4a4a4a;
            border-color: #4CAF50;
        }

        .tab-btn.active {
            background: #4CAF50;
            border-color: #4CAF50;
            color: #fff;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .header h1 {
            font-size: 1.3em;
            color: #4CAF50;
            font-weight: 600;
        }

        .section {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #666;
        }

        .section h2 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1em;
            font-weight: 600;
        }

        textarea {
            width: 100%;
            min-height: 80px;
            background: #1a1a1a;
            border: 1px solid #444;
            color: #e0e0e0;
            padding: 10px;
            border-radius: 4px;
            font-family: 'Segoe UI', monospace;
            font-size: 13px;
            resize: vertical;
        }

        textarea:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 8px 16px;
            background: #3a3a3a;
            border: 1px solid #555;
            color: #e0e0e0;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.2s ease;
            font-size: 13px;
        }

        button:hover {
            background: #4a4a4a;
            border-color: #666;
        }

        .btn-primary {
            background: #4CAF50;
            border-color: #4CAF50;
            color: #fff;
        }

        .btn-primary:hover {
            background: #45a049;
            border-color: #45a049;
        }

        .btn-schedule {
            background: #ff9800;
            border-color: #ff9800;
            color: #fff;
        }

        .btn-schedule:hover {
            background: #f57c00;
            border-color: #f57c00;
        }

        input[type="date"] {
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #4CAF50;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
            cursor: pointer;
        }

        input[type="date"]:focus {
            outline: none;
            border-color: #45a049;
        }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .slot {
            background: #2a2a2a;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
        }

        .slot h3 {
            color: #4CAF50;
            margin-bottom: 4px;
            font-size: 0.95em;
            font-weight: 600;
        }

        .slot-time {
            color: #999;
            font-size: 0.8em;
            margin-bottom: 10px;
        }

        .slot-games {
            min-height: 100px;
            padding: 8px;
            background: #1a1a1a;
            border-radius: 4px;
            border: 2px dashed #444;
            margin-bottom: 8px;
        }

        .slot-games.drag-over {
            border-color: #4CAF50;
            background: rgba(76, 175, 80, 0.1);
        }

        .game-card {
            background: #333;
            padding: 8px;
            margin-bottom: 6px;
            border-radius: 4px;
            cursor: move;
            border-left: 3px solid #4CAF50;
            transition: all 0.2s ease;
        }

        .game-card:hover {
            background: #3a3a3a;
            transform: translateX(3px);
        }

        .game-card.dragging {
            opacity: 0.5;
        }

        .game-team {
            font-weight: 500;
            color: #fff;
            font-size: 0.85em;
        }

        .game-date {
            color: #999;
            font-size: 0.75em;
            margin-top: 3px;
        }

        .select-broadcaster-btn {
            width: 100%;
            background: #5a5a5a;
            border-color: #666;
        }

        .select-broadcaster-btn:hover {
            background: #6a6a6a;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: #2a2a2a;
            padding: 25px;
            border-radius: 8px;
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid #444;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #444;
        }

        .modal-header h2 {
            color: #4CAF50;
            font-size: 1.2em;
            font-weight: 600;
        }

        .close-modal {
            background: transparent;
            border: none;
            color: #999;
            font-size: 28px;
            padding: 0;
            width: 32px;
            height: 32px;
            cursor: pointer;
            line-height: 1;
        }

        .close-modal:hover {
            color: #fff;
        }

        .broadcaster-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .broadcaster-btn {
            padding: 12px;
            background: #3a3a3a;
            border: 1px solid #555;
            color: #e0e0e0;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 500;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 14px;
        }

        .broadcaster-btn:hover {
            background: #4a4a4a;
            border-color: #666;
        }

        .broadcaster-btn.selected {
            background: #4CAF50;
            border-color: #4CAF50;
            color: #fff;
            font-weight: 600;
        }

        .output-section {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #666;
        }

        .output-section h2 {
            color: #4CAF50;
            margin-bottom: 12px;
            font-size: 1em;
            font-weight: 600;
        }

        .output-panels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 15px;
        }

        .output-panel {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid #444;
        }

        .output-panel h3 {
            color: #4CAF50;
            margin-bottom: 8px;
            font-size: 0.95em;
            font-weight: 600;
        }

        #mainOutput, #overlapsOutput {
            background: #0a0a0a;
            padding: 12px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.6;
            border: 1px solid #333;
        }

        .copy-btn {
            width: 100%;
            margin-top: 10px;
            background: #4CAF50;
            border-color: #4CAF50;
            color: #fff;
        }

        .copy-btn:hover {
            background: #45a049;
            border-color: #45a049;
        }

        .unassigned-games {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #666;
        }

        .unassigned-games h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 0.95em;
            font-weight: 600;
        }

        .selected-broadcasters {
            margin-top: 12px;
            padding: 10px;
            background: #1a1a1a;
            border-radius: 4px;
            font-size: 0.85em;
            border: 1px solid #333;
        }

        .selected-broadcasters .label {
            color: #4CAF50;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .selected-broadcasters .list {
            color: #aaa;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .slots-grid {
                grid-template-columns: 1fr;
            }
            
            .output-panels {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('nfl')">NFL Term Helper</button>
            <button class="tab-btn" onclick="switchTab('viaplay')">Viaplay Helper</button>
        </div>

        <div id="nflContent" class="tab-content active">
        <div class="header">
            <h1>Omairs NFL Term Helper</h1>
            <button class="btn-schedule" onclick="window.open('https://airtable.com/appO1hG5OwPeV2zpW/shrTsMDi5SqUhv7Dk/tblP7r6oG5Nrc4pZ5', '_blank')" style="margin-top: 10px;">Take Me To Schedule</button>
        </div>

        <div class="section">
            <h2>Step 1: Add Games</h2>
            <textarea id="gameInput" placeholder="Enter games (format: Team1 at Team2 MM/DD/YY)&#10;Example: Dallas Cowboys at Denver Broncos 10/26/25"></textarea>
            <div class="button-group">
                <button class="btn-primary" onclick="generateGames()">Generate Games</button>
                <button onclick="resetAll()" style="background: #d32f2f; border-color: #d32f2f; color: white;">Reset All</button>
                <button onclick="exportData()">Export Data</button>
                <button onclick="document.getElementById('importFile').click()">Import Data</button>
                <input type="file" id="importFile" style="display:none" accept=".json" onchange="importData(event)">
            </div>
        </div>

        <div class="section">
            <h2>Step 2: Select Date for Time Slots</h2>
            <input type="date" id="datePicker">
        </div>

        <div class="unassigned-games" id="unassignedGames">
            <h3>Step 3: Arrange Games (Drag to Slots Below)</h3>
            <div id="unassignedGamesList"></div>
        </div>

        <div class="slots-grid">
            <div class="slot">
                <h3>Slot 1</h3>
                <div class="slot-time">6:00 PM - 9:30 PM</div>
                <div class="slot-games" id="slot1" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                <button class="select-broadcaster-btn" onclick="selectSlot(1)">Select Broadcasters</button>
                <div class="selected-broadcasters" id="selected1"></div>
            </div>
            <div class="slot">
                <h3>Slot 2</h3>
                <div class="slot-time">9:05 PM - 12:35 AM</div>
                <div class="slot-games" id="slot2" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                <button class="select-broadcaster-btn" onclick="selectSlot(2)">Select Broadcasters</button>
                <div class="selected-broadcasters" id="selected2"></div>
            </div>
            <div class="slot">
                <h3>Slot 3</h3>
                <div class="slot-time">9:25 PM - 12:55 AM</div>
                <div class="slot-games" id="slot3" ondrop="drop(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)"></div>
                <button class="select-broadcaster-btn" onclick="selectSlot(3)">Select Broadcasters</button>
                <div class="selected-broadcasters" id="selected3"></div>
            </div>
        </div>

        <div class="output-section" id="outputSection" style="display:none">
            <h2>Generated Output</h2>
            <div class="output-panels">
                <div class="output-panel">
                    <h3>Main Output</h3>
                    <div id="mainOutput"></div>
                    <button class="copy-btn" onclick="copyToClipboard('mainOutput')">Copy Main Output</button>
                </div>
                <div class="output-panel">
                    <h3>Overlaps Output</h3>
                    <div id="overlapsOutput"></div>
                    <button class="copy-btn" onclick="copyToClipboard('overlapsOutput')">Copy Overlaps</button>
                </div>
            </div>
        </div>
        </div>

        <div id="viaplayContent" class="tab-content">
            <div class="header">
                <h1>Viaplay Helper</h1>
                <button class="btn-schedule" onclick="window.open('https://www.livesoccertv.com/', '_blank')" style="margin-top: 10px;">Take Me To Schedule</button>
            </div>
            <div class="section">
                <h2>Input Text</h2>
                <textarea id="viaplayInput" placeholder="Paste your match schedule here..." style="min-height: 200px;"></textarea>
                <div class="button-group">
                    <button class="btn-primary" onclick="processViaplayText()">Generate Output</button>
                    <button onclick="clearViaplay()">Clear All</button>
                </div>
            </div>
            <div class="output-section" id="viaplayOutputSection" style="display:none">
                <h2>Generated Output</h2>
                <div id="viaplayOutput" style="background: #0a0a0a; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-wrap; max-height: 400px; overflow-y: auto; line-height: 1.6; border: 1px solid #333; color: #d0d0d0;"></div>
                <button class="copy-btn" onclick="copyViaplayOutput()">Copy Output</button>
            </div>
        </div>
    </div>

    <div class="modal" id="broadcasterModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Select Broadcasters</h2>
                <button class="close-modal" onclick="closeModal()">×</button>
            </div>
            <div class="broadcaster-grid" id="broadcasterGrid"></div>
            <div class="button-group">
                <button class="btn-primary" onclick="saveBroadcasterSelection()">Save Selection</button>
                <button onclick="closeModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        var games = [];
        var slots = {1: [], 2: [], 3: []};
        var broadcasters = {1: [], 2: [], 3: []};
        var overlaps = {};
        var currentSlot = null;
        var selectedDate = null;
        var timeSlots = {
            slot1: { start: '', end: '' },
            slot2: { start: '', end: '' },
            slot3: { start: '', end: '' }
        };

        // Broadcaster Database
        const broadcasterDatabase = {
            "Youtube TV": ["Youtube TV (51)", "YoutubeTV (51)", "Youtube Sunday Ticket (51)", "YoutubeSundayTicket (51)"],
            "CBS": ["CBS (51)"],
            "Fox": ["Fox (51)"],
            "NFL Red Zone": ["NFL Red Zone (51)", "NFLRedZone (51)"],
            "TSN": ["TSN (51)", "TSN1 (51)", "TSN 1 (51)"],
            "TSN 2": ["TSN2 (51)", "TSN 2 (51)"],
            "TSN 3": ["TSN3 (51)", "TSN 3 (51)"],
            "TSN 4": ["TSN4 (51)", "TSN 4 (51)"],
            "TSN 5": ["TSN5 (51)", "TSN 5  (51)"],
            "Fubo Sports US": ["Fubo Sports US (51)"],
            "Fubo Sports CA": ["Fubo Sports CA (51)"],
            "Paramount Plus": ["Paramount Plus (51)", "ParamountPlus (51)"],
            "CTV": ["CTV (51)"],
            "NFL Plus": ["NFL Plus (51)", "NFLPlus (51)"],
            "NFL ST": ["NFL Sunday Ticket (51)", "NFLSundayTicket (51)"],
            "CTV 2": ["CTV 2 (51)", "CTV2 (51)"],
            "CBS LA": ["CBS Los Angeles (51)", "CBS LosAngeles (51)", "CBSLosAngeles (51)"],
            "RDS": ["RDS1 (51)", "RDS 1 (51)"],
            "RDS 2": ["RDS2 (51)", "RDS 2 (51)"]
        };

        // Default entries
        const defaultEntries = [
            "NFL (26)",
            "NFL Sunday Ticket (26)",
            "Youtube TV (51)",
            "YoutubeTV (51)",
            "Youtube Sunday Ticket (51)",
            "YoutubeSundayTicket (51)",
            "CBS (51)",
            "Fox (51)",
            "NFL Red Zone (51)",
            "NFLRedZone (51)"
        ];

        const defaultBroadcasterNames = ["Youtube TV", "CBS", "Fox", "NFL Red Zone", "NFL ST"];

        // Team Database
        const teamDatabase = {
            "Dallas Cowboys": ["Dallas (26)", "Cowboys (26)"],
            "New England Patriots": ["New England (26)", "Patriots (26)"],
            "Denver Broncos": ["Denver (26)", "Broncos (26)"],
            "Miami Dolphins": ["Miami (26)", "Dolphins (26)"],
            "Kansas City Chiefs": ["Kansas City (26)", "Chiefs (26)"],
            "Green Bay Packers": ["Green Bay (26)", "Packers (26)"],
            "San Francisco 49ers": ["San Francisco (26)", "49ers (26)"],
            "Pittsburgh Steelers": ["Pittsburgh (26)", "Steelers (26)"],
            "Buffalo Bills": ["Buffalo (26)", "Bills (26)"],
            "Las Vegas Raiders": ["Las Vegas (26)", "Raiders (26)"],
            "Los Angeles Rams": ["Los Angeles (26)", "LA Rams (26)", "Rams (26)"],
            "Los Angeles Chargers": ["LA Chargers (26)", "Chargers (26)"],
            "Philadelphia Eagles": ["Philadelphia (26)", "Eagles (26)"],
            "Seattle Seahawks": ["Seattle (26)", "Seahawks (26)"],
            "Baltimore Ravens": ["Baltimore (26)", "Ravens (26)"],
            "Minnesota Vikings": ["Minnesota (26)", "Vikings (26)"],
            "Tampa Bay Buccaneers": ["Tampa Bay (26)", "Buccaneers (26)"],
            "Chicago Bears": ["Chicago (26)", "Bears (26)"],
            "New York Giants": ["New York (26)", "NY Giants (26)", "Giants (26)"],
            "New York Jets": ["NY Jets (26)", "Jets (26)"],
            "Cleveland Browns": ["Cleveland (26)", "Browns (26)"],
            "Cincinnati Bengals": ["Cincinnati (26)", "Bengals (26)"],
            "Indianapolis Colts": ["Indianapolis (26)", "Colts (26)"],
            "Tennessee Titans": ["Tennessee (26)", "Titans (26)"],
            "Houston Texans": ["Houston (26)", "Texans (26)"],
            "Jacksonville Jaguars": ["Jacksonville (26)", "Jaguars (26)"],
            "Washington Commanders": ["Washington (26)", "Commanders (26)"],
            "Arizona Cardinals": ["Arizona (26)", "Cardinals (26)"],
            "Carolina Panthers": ["Carolina (26)", "Panthers (26)"],
            "Atlanta Falcons": ["Atlanta (26)", "Falcons (26)"],
            "New Orleans Saints": ["New Orleans (26)", "Saints (26)"],
            "Detroit Lions": ["Detroit (26)", "Lions (26)"]
        };

        // Initialize
        initBroadcasterModal();
        initDatePicker();

        // Tab switching
        function switchTab(tab) {
            const nflContent = document.getElementById('nflContent');
            const viaplayContent = document.getElementById('viaplayContent');
            const tabs = document.querySelectorAll('.tab-btn');
            
            if (tab === 'nfl') {
                nflContent.classList.add('active');
                viaplayContent.classList.remove('active');
                tabs[0].classList.add('active');
                tabs[1].classList.remove('active');
            } else {
                nflContent.classList.remove('active');
                viaplayContent.classList.add('active');
                tabs[0].classList.remove('active');
                tabs[1].classList.add('active');
            }
        }

        // Viaplay Helper Functions
        function processViaplayText() {
            const input = document.getElementById('viaplayInput').value.trim();
            
            if (!input) {
                alert('Please enter match schedule text first!');
                return;
            }

            const broadcasters = [
                "viaplay (51)",
                "tv sport (51)",
                "tv 2 (51)",
                "tv2 (51)",
                "v sport (51)",
                "Canal GOAT (51)",
                "Sportklub 8 (51)",
                "Onefootball (51)",
                "MaxTV Go (51)",
                "TV 2 Play (51)",
                "Arena Sport 5 (51)",
                "SportKlub (51)",
                "Onefootball (51)"
            ];

            let output = '';
            const lines = input.split('\n');
            let currentDate = null;
            let currentYear = new Date().getFullYear();
            const matchesByDate = {};

            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Parse date lines
                const dateMatch = line.match(/(?:__|)(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday),?\s+(\d{1,2})\s+(\w+)(?:__|)/i);
                if (dateMatch) {
                    const day = dateMatch[1].padStart(2, '0');
                    const monthName = dateMatch[2];
                    const monthMap = {
                        'january': '01', 'february': '02', 'march': '03', 'april': '04',
                        'may': '05', 'june': '06', 'july': '07', 'august': '08',
                        'september': '09', 'october': '10', 'november': '11', 'december': '12'
                    };
                    const month = monthMap[monthName.toLowerCase()];
                    currentDate = `${currentYear}-${month}-${day}`;
                    
                    if (!matchesByDate[currentDate]) {
                        matchesByDate[currentDate] = [];
                    }
                    continue;
                }

                // Parse time and match lines
                const timeMatch = line.match(/^(\d{1,2}):(\d{2})(am|pm)$/i);
                if (timeMatch && currentDate) {
                    let hours = parseInt(timeMatch[1]);
                    const minutes = timeMatch[2];
                    const period = timeMatch[3].toLowerCase();
                    
                    if (period === 'pm' && hours !== 12) hours += 12;
                    if (period === 'am' && hours === 12) hours = 0;
                    
                    const startTime = `${currentDate} ${hours.toString().padStart(2, '0')}:${minutes}:00`;
                    
                    // Look ahead for team names
                    if (i + 1 < lines.length) {
                        const nextLine = lines[i + 1].trim();
                        const teamsMatch = nextLine.match(/(.+?)\s+vs\s+(.+?)(?:\s|$)/i);
                        if (teamsMatch) {
                            const team1 = teamsMatch[1].trim();
                            const team2 = teamsMatch[2].trim();
                            
                            matchesByDate[currentDate].push({
                                startTime: startTime,
                                team1: team1,
                                team2: team2
                            });
                        }
                    }
                }
            }

            // Generate output grouped by date
            Object.keys(matchesByDate).sort().forEach(date => {
                const matches = matchesByDate[date];
                
                if (matches.length > 0) {
                    // Find earliest start and latest end for the day
                    const times = matches.map(m => m.startTime);
                    const earliestStart = times[0];
                    
                    // Calculate latest end (last match start + 2 hours)
                    const lastMatchTime = times[times.length - 1];
                    const lastDate = new Date(lastMatchTime);
                    lastDate.setHours(lastDate.getHours() + 2);
                    const latestEnd = lastDate.toISOString().slice(0, 19).replace('T', ' ');
                    
                    // Add day summary times (color coded)
                    output += `<span style="color: #4CAF50; font-weight: bold;">${earliestStart}</span>\n`;
                    output += `<span style="color: #d32f2f; font-weight: bold;">${latestEnd}</span>\n`;
                    
                    // Add all teams from all matches on this day
                    matches.forEach(match => {
                        // Check if team has a slash and split if needed
                        if (match.team1.includes('/')) {
                            const parts = match.team1.split('/').map(p => p.trim());
                            parts.forEach(part => {
                                output += `${part} (26)\n`;
                            });
                        } else {
                            output += `${match.team1} (26)\n`;
                        }
                        
                        if (match.team2.includes('/')) {
                            const parts = match.team2.split('/').map(p => p.trim());
                            parts.forEach(part => {
                                output += `${part} (26)\n`;
                            });
                        } else {
                            output += `${match.team2} (26)\n`;
                        }
                    });
                    
                    // Add broadcasters
                    broadcasters.forEach(b => {
                        output += b + '\n';
                    });
                    
                    output += '\n';
                }
            });

            document.getElementById('viaplayOutput').innerHTML = output || 'No matches parsed.';
            document.getElementById('viaplayOutputSection').style.display = 'block';
        }

        function clearViaplay() {
            document.getElementById('viaplayInput').value = '';
            document.getElementById('viaplayOutput').innerHTML = '';
            document.getElementById('viaplayOutputSection').style.display = 'none';
        }

        function copyViaplayOutput() {
            const element = document.getElementById('viaplayOutput');
            const text = element.innerText || element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        // Auto-generate tables when changes are made
        function autoGenerateTables() {
            const hasGames = games.length > 0;
            const hasBroadcasters = broadcasters[1].length > 0 || broadcasters[2].length > 0 || broadcasters[3].length > 0;
            
            if (hasGames || hasBroadcasters) {
                generateBroadcasterTables();
            }
        }

        function initDatePicker() {
            document.getElementById('datePicker').addEventListener('change', function() {
                generateTimeSlots();
            });
        }

        function generateTimeSlots() {
            const dateValue = document.getElementById('datePicker').value;
            
            if (!dateValue) return;
            
            selectedDate = dateValue;
            const [year, month, day] = dateValue.split('-');
            const nextDay = new Date(year, month - 1, parseInt(day) + 1);
            const nextDayStr = nextDay.toISOString().split('T')[0];
            
            timeSlots.slot1.start = `${dateValue} 18:00:00`;
            timeSlots.slot1.end = `${dateValue} 21:30:00`;
            
            timeSlots.slot2.start = `${dateValue} 21:05:00`;
            timeSlots.slot2.end = `${nextDayStr} 00:35:00`;
            
            timeSlots.slot3.start = `${dateValue} 21:25:00`;
            timeSlots.slot3.end = `${nextDayStr} 00:55:00`;
            
            autoGenerateTables();
        }

        function generateGames() {
            const input = document.getElementById('gameInput').value.trim();
            if (!input) return;

            const lines = input.split('\n');
            games = [];

            lines.forEach((line, index) => {
                const match = line.match(/(.+?)\s+at\s+(.+?)\s+(\d{1,2}\/\d{1,2}\/\d{2,4})/i);
                if (match) {
                    games.push({
                        team1: match[1].trim(),
                        team2: match[2].trim(),
                        date: match[3].trim(),
                        id: Date.now() + index
                    });
                }
            });

            displayUnassignedGames();
        }

        function displayUnassignedGames() {
            const container = document.getElementById('unassignedGamesList');
            const assignedIds = [...slots[1], ...slots[2], ...slots[3]];
            const unassigned = games.filter(g => !assignedIds.includes(g.id));

            container.innerHTML = unassigned.map(game => `
                <div class="game-card" draggable="true" ondragstart="drag(event)" data-id="${game.id}">
                    <div class="game-team">${game.team1} at ${game.team2}</div>
                    <div class="game-date">${game.date}</div>
                </div>
            `).join('');
        }

        function drag(ev) {
            ev.dataTransfer.setData("gameId", ev.target.getAttribute('data-id'));
            ev.target.classList.add('dragging');
        }

        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }

        function dragLeave(ev) {
            ev.currentTarget.classList.remove('drag-over');
        }

        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');
            
            const gameId = parseInt(ev.dataTransfer.getData("gameId"));
            const slotId = parseInt(ev.currentTarget.id.replace('slot', ''));
            
            Object.keys(slots).forEach(key => {
                slots[key] = slots[key].filter(id => id !== gameId);
            });
            
            slots[slotId].push(gameId);
            
            displaySlots();
            displayUnassignedGames();
            autoGenerateTables();
        }

        function displaySlots() {
            [1, 2, 3].forEach(slotNum => {
                const container = document.getElementById(`slot${slotNum}`);
                const slotGames = games.filter(g => slots[slotNum].includes(g.id));
                
                container.innerHTML = slotGames.map(game => `
                    <div class="game-card" draggable="true" ondragstart="drag(event)" data-id="${game.id}">
                        <div class="game-team">${game.team1} at ${game.team2}</div>
                        <div class="game-date">${game.date}</div>
                    </div>
                `).join('');
            });
        }

        function initBroadcasterModal() {
            const grid = document.getElementById('broadcasterGrid');
            grid.innerHTML = Object.keys(broadcasterDatabase).map(name => `
                <button class="broadcaster-btn" data-broadcaster="${name}" onclick="handleBroadcasterClick('${name}', this)">
                    ${name}
                </button>
            `).join('');
        }

        function selectSlot(slotNum) {
            currentSlot = slotNum;
            document.getElementById('modalTitle').textContent = `Select Broadcasters - Slot ${slotNum}`;
            
            const buttons = document.querySelectorAll('.broadcaster-btn');
            buttons.forEach(btn => {
                const name = btn.getAttribute('data-broadcaster');
                if (broadcasters[slotNum] && broadcasters[slotNum].includes(name)) {
                    btn.classList.add('selected');
                } else {
                    btn.classList.remove('selected');
                }
            });
            
            document.getElementById('broadcasterModal').classList.add('active');
        }

        function handleBroadcasterClick(broadcasterName, buttonElement) {
            if (!currentSlot) return;
            
            const index = broadcasters[currentSlot].indexOf(broadcasterName);
            if (index > -1) {
                broadcasters[currentSlot].splice(index, 1);
                buttonElement.classList.remove('selected');
            } else {
                broadcasters[currentSlot].push(broadcasterName);
                buttonElement.classList.add('selected');
            }
        }

        function saveBroadcasterSelection() {
            if (currentSlot) {
                broadcasters[currentSlot] = broadcasters[currentSlot].filter(b => 
                    !defaultBroadcasterNames.includes(b)
                );
                
                updateSelectedBroadcasters(currentSlot);
                autoGenerateTables();
            }
            closeModal();
        }

        function updateSelectedBroadcasters(slotNum) {
            const container = document.getElementById(`selected${slotNum}`);
            const count = broadcasters[slotNum] ? broadcasters[slotNum].length : 0;
            const total = Object.keys(broadcasterDatabase).length;
            
            if (count > 0) {
                container.innerHTML = `
                    <div class="label">Selected: ${count} of ${total} broadcasters</div>
                    <div class="list">${broadcasters[slotNum].join(', ')}</div>
                `;
            } else {
                container.innerHTML = '';
            }
        }

        function closeModal() {
            document.getElementById('broadcasterModal').classList.remove('active');
            currentSlot = null;
        }

        function generateBroadcasterTables() {
            let mainOutput = '';
            let overlapsOutput = '';
            overlaps = {};

            const hasTimeSlots = timeSlots.slot1.start !== '';

            const broadcasterSlots = {};
            [1, 2, 3].forEach(slotNum => {
                broadcasters[slotNum].forEach(b => {
                    if (!broadcasterSlots[b]) broadcasterSlots[b] = [];
                    broadcasterSlots[b].push(slotNum);
                });
            });

            Object.keys(broadcasterSlots).forEach(b => {
                const slotsList = broadcasterSlots[b].sort((a, c) => a - c);
                let isOverlap = false;
                
                if (slotsList.length === 2) {
                    if (slotsList[1] - slotsList[0] === 1) {
                        isOverlap = true;
                    }
                } else if (slotsList.length === 3) {
                    isOverlap = true;
                }
                
                if (isOverlap) {
                    overlaps[b] = slotsList;
                }
            });

            [1, 2, 3].forEach(slotNum => {
                const uniqueBroadcasters = broadcasters[slotNum].filter(b => !overlaps[b]);
                
                if (uniqueBroadcasters.length > 0 || slots[slotNum].length > 0) {
                    mainOutput += `<span style="color: #ff9800; font-weight: bold;">*** Slot ${slotNum} Unique ***</span>\n`;
                    
                    if (hasTimeSlots) {
                        const slotKey = 'slot' + slotNum;
                        mainOutput += `<span style="color: #4CAF50; font-weight: bold;">${timeSlots[slotKey].start}</span>\n`;
                        mainOutput += `<span style="color: #d32f2f; font-weight: bold;">${timeSlots[slotKey].end}</span>\n`;
                    }
                    
                    uniqueBroadcasters.forEach(b => {
                        const variations = broadcasterDatabase[b] || [b];
                        variations.forEach(v => {
                            mainOutput += v + '\n';
                        });
                    });
                    
                    const slotGames = games.filter(g => slots[slotNum].includes(g.id));
                    slotGames.forEach(game => {
                        if (teamDatabase[game.team1]) {
                            teamDatabase[game.team1].forEach(v => mainOutput += v + '\n');
                        }
                        if (teamDatabase[game.team2]) {
                            teamDatabase[game.team2].forEach(v => mainOutput += v + '\n');
                        }
                    });
                    
                    mainOutput += '\n';
                }
            });

            if (Object.keys(overlaps).length > 0) {
                const overlapGroups = {};
                Object.keys(overlaps).forEach(b => {
                    const slotsKey = overlaps[b].join('-');
                    if (!overlapGroups[slotsKey]) {
                        overlapGroups[slotsKey] = {
                            slots: overlaps[b],
                            broadcasters: []
                        };
                    }
                    overlapGroups[slotsKey].broadcasters.push(b);
                });

                Object.keys(overlapGroups).sort().forEach(key => {
                    const group = overlapGroups[key];
                    const slotsList = group.slots.join(', ');
                    
                    overlapsOutput += `<span style="color: #ff9800; font-weight: bold;">*** Slot ${slotsList} Overlaps ***</span>\n`;
                    
                    if (hasTimeSlots) {
                        const firstSlot = group.slots[0];
                        const lastSlot = group.slots[group.slots.length - 1];
                        const startTime = timeSlots['slot' + firstSlot].start;
                        const endTime = timeSlots['slot' + lastSlot].end;
                        overlapsOutput += `<span style="color: #4CAF50; font-weight: bold;">${startTime}</span>\n`;
                        overlapsOutput += `<span style="color: #d32f2f; font-weight: bold;">${endTime}</span>\n`;
                    }
                    
                    group.broadcasters.forEach(b => {
                        const variations = broadcasterDatabase[b] || [b];
                        variations.forEach(v => {
                            overlapsOutput += v + '\n';
                        });
                    });
                    
                    overlapsOutput += '\n';
                });
            }

            overlapsOutput += `<span style="color: #ff9800; font-weight: bold;">*** Default Entries ***</span>\n`;
            
            if (hasTimeSlots) {
                overlapsOutput += `<span style="color: #4CAF50; font-weight: bold;">${timeSlots.slot1.start}</span>\n`;
                overlapsOutput += `<span style="color: #d32f2f; font-weight: bold;">${timeSlots.slot3.end}</span>\n`;
            }
            
            defaultEntries.forEach(entry => {
                overlapsOutput += entry + '\n';
            });

            document.getElementById('mainOutput').innerHTML = mainOutput || 'No output generated yet.';
            document.getElementById('overlapsOutput').innerHTML = overlapsOutput || 'No overlapping broadcasters.';
            document.getElementById('outputSection').style.display = 'block';
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.innerText || element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function resetAll() {
            games = [];
            slots = {1: [], 2: [], 3: []};
            broadcasters = {1: [], 2: [], 3: []};
            overlaps = {};
            currentSlot = null;
            selectedDate = null;
            timeSlots = {
                slot1: { start: '', end: '' },
                slot2: { start: '', end: '' },
                slot3: { start: '', end: '' }
            };
            
            document.getElementById('gameInput').value = '';
            document.getElementById('datePicker').value = '';
            document.getElementById('unassignedGamesList').innerHTML = '';
            document.getElementById('slot1').innerHTML = '';
            document.getElementById('slot2').innerHTML = '';
            document.getElementById('slot3').innerHTML = '';
            document.getElementById('selected1').innerHTML = '';
            document.getElementById('selected2').innerHTML = '';
            document.getElementById('selected3').innerHTML = '';
            document.getElementById('mainOutput').innerHTML = '';
            document.getElementById('overlapsOutput').innerHTML = '';
            
            const outputSection = document.getElementById('outputSection');
            if (outputSection) {
                outputSection.style.display = 'none';
            }
            
            document.querySelectorAll('.broadcaster-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            alert('✓ Reset Complete!');
        }

        function exportData() {
            const data = {
                games: games,
                slots: slots,
                broadcasters: broadcasters,
                timestamp: Date.now()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `nfl-broadcaster-data-${Date.now()}.json`;
            a.click();
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    games = data.games || [];
                    slots = data.slots || {1: [], 2: [], 3: []};
                    broadcasters = data.broadcasters || {1: [], 2: [], 3: []};
                    displayUnassignedGames();
                    displaySlots();
                    [1, 2, 3].forEach(n => updateSelectedBroadcasters(n));
                    alert('Data imported successfully!');
                } catch (err) {
                    alert('Error importing data: ' + err.message);
                }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>